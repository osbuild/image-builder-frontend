name: Boot tests

on:
  schedule:
    - cron: '5 0 * * 1-5' # working days at midnight 
  workflow_dispatch:
    inputs:
      pr_number:
        description: 'Pull Request number to run tests against'
        required: false
        type: number

jobs:
  boot-tests:
    runs-on:
      - ubuntu-latest
    permissions:
      pull-requests: read

    steps:
      
      - name: Run front-end Playwright tests
        id: playwright-tests
        env:
          BASE_URL: https://stage.foo.redhat.com:1337
        run: |
          echo "Hello"

      - name: Notify Slack on success
        uses: slackapi/slack-github-action@v2.1.1
        if: steps.playwright-tests.result == 'success'
        with:
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            {
              "attachments": [
                {
                  "color": "#2EB67D",
                  "blocks": [
                    {
                      "type": "section",
                      "text": {
                        "type": "mrkdwn",
                        "text": "<${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}/ | :stars: Nightly boot test run>: *SUCCESS* :partymeow:"
                      }
                    }
                  ]
                }
              ]
            }

      - name: Notify Slack on failure
        uses: slackapi/slack-github-action@v2.1.1
        if: steps.playwright-tests.result != 'success'
        with:
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          webhook-type: incoming-webhook
          payload: |
            {
              "attachments": [
                {
                  "color": "#d72839",
                  "blocks": [
                    {
                      "type": "section",
                      "text": {
                        "type": "mrkdwn",
                        "text": "<${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}/ | :stars: Nightly boot test run>: *FAILED* :big-sad:"
                      }
                    }
                  ]
                }
              ]
            }
